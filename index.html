<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Visual Memory</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;overflow-x:hidden}
body{font-family:Georgia,serif;background:linear-gradient(135deg,#0a0e27,#1a1034,#2d1b4e);min-height:100vh;color:#e8e8f0;display:flex;flex-direction:column;align-items:center;padding:8px;-webkit-tap-highlight-color:transparent}
.title{font-size:1.4em;background:linear-gradient(135deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.subtitle{color:#d4af37;margin-bottom:6px;font-size:0.8em}
.box{background:rgba(255,255,255,0.05);border:2px solid rgba(212,175,55,0.5);border-radius:12px;padding:10px;width:calc(100% - 16px);max-width:340px}
.hidden{display:none!important}
.banner{background:rgba(255,215,0,0.2);border:1px solid rgba(255,215,0,0.5);color:#ffd700;padding:4px 8px;border-radius:8px;font-size:0.7em}
.back{padding:4px 8px;background:rgba(255,255,255,0.1);border:1px solid rgba(212,175,55,0.3);border-radius:8px;color:#ffd700;text-decoration:none;font-size:0.7em}
.top-bar{width:calc(100% - 16px);max-width:340px;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.popup-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:5000;padding:12px}
.popup{background:linear-gradient(135deg,#1a1034,#2d1b4e);border:2px solid rgba(255,215,0,0.3);border-radius:12px;padding:16px;width:90%;max-width:260px;text-align:center}
.popup h3{color:#e8e8f0;margin-bottom:4px;font-size:0.95em}
.popup p{color:#a0a0b8;font-size:0.75em;margin-bottom:12px}
.popup a{display:block;padding:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#e8e8f0;text-decoration:none;margin-bottom:10px;font-size:0.8em}
.popup button{width:100%;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a1034;border:none;padding:8px;border-radius:12px;font-weight:bold;cursor:pointer;font-size:0.85em}
.pin-title{color:#ffd700;font-size:1em;text-align:center;margin-bottom:4px}
.pin-sub{color:#b8b8cc;text-align:center;margin-bottom:12px;font-size:0.75em}
.dots{display:flex;justify-content:center;gap:8px;margin-bottom:12px}
.dot{width:12px;height:12px;border-radius:50%;border:2px solid rgba(212,175,55,0.5)}
.dot.on{background:#ffd700;border-color:#ffd700}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;max-width:180px;margin:0 auto 10px}
.key{aspect-ratio:1;font-size:1.1em;border:2px solid rgba(212,175,55,0.3);background:rgba(255,255,255,0.05);color:#e8e8f0;border-radius:6px;cursor:pointer}
.key:active{transform:scale(0.95)}
.key.empty{visibility:hidden}
.msg{text-align:center;min-height:16px;font-size:0.75em}
.msg.err{color:#ff6b6b}
.msg.ok{color:#4ecdc4}
.toggle{text-align:center;margin-top:10px;color:#b8b8cc;font-size:0.75em}
.toggle span{color:#ffd700;cursor:pointer;text-decoration:underline}
.btn{width:100%;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a1034;border:none;padding:10px;border-radius:15px;font-size:0.85em;font-weight:bold;cursor:pointer;margin-top:5px}
.btn:active{transform:scale(0.98)}
.btn2{background:linear-gradient(135deg,#8a2be2,#4b0082);color:#fff}
.welcome{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:8px;padding:10px;margin-bottom:10px;text-align:center}
.welcome h3{color:#ffd700;margin-bottom:2px;font-size:0.95em}
.welcome p{font-size:0.75em;color:#b8b8cc}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin:10px 0}
.stat{background:rgba(255,255,255,0.05);padding:8px;border-radius:6px;text-align:center;border:1px solid rgba(212,175,55,0.2)}
.stat b{display:block;font-size:1.2em;color:#ffd700}
.stat span{color:#b8b8cc;font-size:0.65em}
.game-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:0 5px}
.game-stat{text-align:center}
.game-stat b{display:block;font-size:1.1em;color:#ffd700}
.game-stat span{color:#b8b8cc;font-size:0.65em}
.grid-container{background:rgba(0,0,0,0.3);border-radius:12px;padding:12px;margin:10px 0}
.visual-grid{display:grid;gap:6px;max-width:280px;margin:0 auto}
.visual-cell{aspect-ratio:1;background:rgba(255,255,255,0.1);border:2px solid rgba(212,175,55,0.3);border-radius:8px;cursor:pointer;transition:all 0.15s}
.visual-cell.lit{background:linear-gradient(135deg,#ffd700,#ff8c00);border-color:#ffd700;box-shadow:0 0 15px rgba(255,215,0,0.5)}
.visual-cell.selected{background:linear-gradient(135deg,#3498db,#2980b9);border-color:#3498db}
.visual-cell.correct{background:linear-gradient(135deg,#2ecc71,#27ae60);border-color:#2ecc71}
.visual-cell.wrong{background:linear-gradient(135deg,#e74c3c,#c0392b);border-color:#e74c3c}
.visual-cell:active{transform:scale(0.95)}
.visual-cell.disabled{pointer-events:none}
.status-msg{text-align:center;color:#ffd700;font-size:0.9em;margin:10px 0;min-height:24px}
.lives{display:flex;justify-content:center;gap:5px;margin:8px 0}
.life{font-size:1.2em}
.life.lost{opacity:0.3}
.res-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:3000;padding:12px}
.res{background:linear-gradient(135deg,#1a1034,#2d1b4e);border:2px solid #ffd700;border-radius:12px;padding:16px 12px;width:90%;max-width:300px;text-align:center}
.res h2{color:#ffd700;margin-bottom:6px;font-size:1.1em}
.res-score{font-size:2.5em;color:#ffd700;font-weight:bold}
.res-label{color:#b8b8cc;margin-bottom:10px;font-size:0.8em}
.res-details{display:flex;justify-content:space-around;margin:10px 0}
.res-detail{text-align:center}
.res-detail b{display:block;color:#ffd700;font-size:1.2em}
.res-detail span{color:#b8b8cc;font-size:0.7em}
.record{background:rgba(255,215,0,0.2);border:1px solid #ffd700;border-radius:5px;padding:6px;margin:8px 0;color:#ffd700;font-weight:bold;font-size:0.85em}
.rating{color:#d4af37;margin-bottom:10px;font-size:0.85em}
</style>
</head>
<body>
<div class="top-bar"><a href="https://hooporiapr-oss.github.io/akashic-works/" class="back">Home</a><div class="banner" id="bannerEl">3 free</div></div>
<div class="title">Visual Memory</div>
<div class="subtitle">Brain Training</div>

<div class="box" id="loginBox">
<div class="pin-title">Enter PIN</div>
<div class="pin-sub">Enter your 4-digit PIN</div>
<div class="dots"><div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div><div class="dot" id="d4"></div></div>
<div class="keypad" id="loginPad"></div>
<div class="msg" id="loginMsg"></div>
<div class="toggle">No account? <span id="toCreate">Create PIN</span></div>
</div>

<div class="box hidden" id="createBox">
<div class="pin-title" id="createTitle">Create PIN</div>
<div class="pin-sub" id="createSub">Choose a 4-digit PIN</div>
<div class="dots"><div class="dot" id="c1"></div><div class="dot" id="c2"></div><div class="dot" id="c3"></div><div class="dot" id="c4"></div></div>
<div class="keypad" id="createPad"></div>
<div class="msg" id="createMsg"></div>
<div class="toggle">Have a PIN? <span id="toLogin">Login</span></div>
</div>

<div class="box hidden" id="dashBox">
<div class="welcome"><h3>Welcome!</h3><p>Remember which tiles light up</p></div>
<div class="stats"><div class="stat"><b id="dGames">0</b><span>Games</span></div><div class="stat"><b id="dBest">--</b><span>Best Level</span></div><div class="stat"><b id="dAvg">--</b><span>Average</span></div><div class="stat"><b id="dRate">--</b><span>Rating</span></div></div>
<button class="btn" id="startBtn">Start Game</button>
<button class="btn btn2" id="logoutBtn">Logout</button>
</div>

<div class="box hidden" id="gameBox">
<div class="game-info"><div class="game-stat"><b id="gLevel">1</b><span>Level</span></div><div class="game-stat"><b id="gTiles">3</b><span>Tiles</span></div><div class="game-stat"><b id="gScore">0</b><span>Score</span></div></div>
<div class="lives" id="livesContainer"><span class="life">‚ù§Ô∏è</span><span class="life">‚ù§Ô∏è</span><span class="life">‚ù§Ô∏è</span></div>
<div class="status-msg" id="statusMsg">Watch the tiles...</div>
<div class="grid-container"><div class="visual-grid" id="visualGrid"></div></div>
<button class="btn btn2" id="quitBtn">Quit</button>
</div>

<div class="res-bg hidden" id="resBg">
<div class="res">
<h2>Game Over!</h2>
<div class="res-score" id="resLevel">0</div>
<div class="res-label">Level Reached</div>
<div class="res-details"><div class="res-detail"><b id="resScore">0</b><span>Score</span></div><div class="res-detail"><b id="resRounds">0</b><span>Rounds</span></div></div>
<div class="record hidden" id="resRecord">New Record!</div>
<div class="rating" id="resRating">Rating: --</div>
<button class="btn" id="againBtn">Play Again</button>
<button class="btn btn2" id="menuBtn">Menu</button>
</div>
</div>

<div class="popup-bg hidden" id="limitPopup">
<div class="popup">
<h3 id="limitTitle">Daily limit reached</h3>
<p id="limitMsg">You used your 3 free games today</p>
<a href="https://hooporiapr-oss.github.io/akashic-works/">Return Home</a>
<button id="upgradeBtn">Unlock Unlimited</button>
</div>
</div>

<script>
(function(){
    var PK = "vmen1_pin";
    var SK = "vmen1_stats_";
    var DK = "vmen1_device";
    var MAX_DAILY = 3;
    var MAX_DAYS = 3;
    
    var currentPin = "";
    var level = 1;
    var score = 0;
    var lives = 3;
    var rounds = 0;
    var gridSize = 3;
    var tilesToShow = 3;
    var litTiles = [];
    var selectedTiles = [];
    var canSelect = false;
    
    function $(id) { return document.getElementById(id); }
    
    function getDeviceId() {
        var id = localStorage.getItem(DK);
        if (!id) {
            id = "dev_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem(DK, id);
        }
        return id;
    }
    
    function getToday() {
        var d = new Date();
        return d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
    }
    
    function getDeviceTries() {
        var key = DK + "_tries";
        try {
            var t = JSON.parse(localStorage.getItem(key));
            if (t && t.startDate) return t;
        } catch (e) {}
        return { n: 0, d: getToday(), startDate: getToday() };
    }
    
    function setDeviceTries(t) {
        localStorage.setItem(DK + "_tries", JSON.stringify(t));
    }
    
    function getDaysDiff(startDate) {
        var start = new Date(startDate);
        var now = new Date();
        return Math.floor((now - start) / (1000 * 60 * 60 * 24));
    }
    
    function canPlay() {
        var t = getDeviceTries();
        var today = getToday();
        var daysSinceStart = getDaysDiff(t.startDate);
        
        if (daysSinceStart >= MAX_DAYS) {
            return { ok: false, left: 0, expired: true, daysLeft: 0 };
        }
        
        if (t.d !== today) {
            t.n = 0;
            t.d = today;
            setDeviceTries(t);
        }
        
        return {
            ok: t.n < MAX_DAILY,
            left: MAX_DAILY - t.n,
            expired: false,
            daysLeft: MAX_DAYS - daysSinceStart
        };
    }
    
    function useTry() {
        var t = getDeviceTries();
        var today = getToday();
        if (t.d !== today) {
            t.n = 0;
            t.d = today;
        }
        t.n++;
        setDeviceTries(t);
        showBanner();
    }
    
    function hash(p) {
        var h = 0;
        var s = p + "vmen1";
        for (var i = 0; i < s.length; i++) {
            h = ((h << 5) - h) + s.charCodeAt(i);
            h = h & h;
        }
        return h.toString(36);
    }
    
    function getPins() {
        try { return JSON.parse(localStorage.getItem(PK)) || {}; }
        catch (e) { return {}; }
    }
    
    function savePins(p) { localStorage.setItem(PK, JSON.stringify(p)); }
    
    function checkPin(p) { return !!getPins()[hash(p)]; }
    
    function savePin(p) {
        var pins = getPins();
        pins[hash(p)] = { created: Date.now() };
        savePins(pins);
    }
    
    function getStats() {
        try {
            return JSON.parse(localStorage.getItem(SK + hash(currentPin))) || { games: 0, bestLevel: 0, totalLevel: 0 };
        } catch (e) {
            return { games: 0, bestLevel: 0, totalLevel: 0 };
        }
    }
    
    function setStats(s) {
        localStorage.setItem(SK + hash(currentPin), JSON.stringify(s));
    }
    
    function showBanner() {
        var c = canPlay();
        if (c.expired) {
            $("bannerEl").textContent = "Trial ended";
        } else {
            $("bannerEl").textContent = c.left + "/" + MAX_DAILY + " (Day " + c.daysLeft + ")";
        }
    }
    
    function showLimit() {
        var c = canPlay();
        if (c.expired) {
            $("limitTitle").textContent = "Free trial ended";
            $("limitMsg").textContent = "Your 3-day free trial has expired";
        } else {
            $("limitTitle").textContent = "Daily limit reached";
            $("limitMsg").textContent = "You used " + MAX_DAILY + " free games today. " + c.daysLeft + " day(s) remaining.";
        }
        $("limitPopup").classList.remove("hidden");
    }
    
    function show(id) {
        ["loginBox", "createBox", "dashBox", "gameBox"].forEach(function(x) {
            $(x).classList.add("hidden");
        });
        $(id).classList.remove("hidden");
    }
    
    function setDots(pre, n) {
        for (var i = 1; i <= 4; i++) {
            var el = $(pre + i);
            if (el) {
                if (i <= n) el.classList.add("on");
                else el.classList.remove("on");
            }
        }
    }
    
    function setMsg(id, t, isErr) {
        var m = $(id);
        m.textContent = t;
        m.className = "msg " + (isErr ? "err" : "ok");
    }
    
    function getRating(lvl) {
        if (!lvl || lvl < 1) return "--";
        if (lvl >= 12) return "Genius";
        if (lvl >= 9) return "Expert";
        if (lvl >= 6) return "Great";
        if (lvl >= 4) return "Good";
        return "Learning";
    }
    
    var loginPin = "";
    var createPin = "";
    var confirmPin = "";
    var isConfirming = false;
    
    function buildKeypad(containerId, onDigit, onDelete) {
        var container = $(containerId);
        container.innerHTML = "";
        
        for (var i = 1; i <= 9; i++) {
            (function(digit) {
                var btn = document.createElement("button");
                btn.className = "key";
                btn.textContent = digit;
                btn.onclick = function() { onDigit(digit); };
                container.appendChild(btn);
            })(i);
        }
        
        var empty = document.createElement("button");
        empty.className = "key empty";
        container.appendChild(empty);
        
        var zero = document.createElement("button");
        zero.className = "key";
        zero.textContent = "0";
        zero.onclick = function() { onDigit(0); };
        container.appendChild(zero);
        
        var del = document.createElement("button");
        del.className = "key";
        del.textContent = "‚Üê";
        del.onclick = onDelete;
        container.appendChild(del);
    }
    
    function setupLogin() {
        buildKeypad("loginPad", function(digit) {
            if (loginPin.length < 4) {
                loginPin += digit;
                setDots("d", loginPin.length);
                if (loginPin.length === 4) {
                    setTimeout(function() {
                        if (checkPin(loginPin)) {
                            currentPin = loginPin;
                            loadDash();
                        } else {
                            setMsg("loginMsg", "Incorrect PIN", true);
                            loginPin = "";
                            setDots("d", 0);
                        }
                    }, 200);
                }
            }
        }, function() {
            if (loginPin.length > 0) {
                loginPin = loginPin.slice(0, -1);
                setDots("d", loginPin.length);
                $("loginMsg").textContent = "";
            }
        });
    }
    
    function setupCreate() {
        buildKeypad("createPad", function(digit) {
            if (confirmPin.length < 4) {
                confirmPin += digit;
                setDots("c", confirmPin.length);
                if (confirmPin.length === 4) {
                    setTimeout(function() {
                        if (!isConfirming) {
                            createPin = confirmPin;
                            confirmPin = "";
                            isConfirming = true;
                            $("createTitle").textContent = "Confirm PIN";
                            $("createSub").textContent = "Enter the PIN again";
                            setDots("c", 0);
                        } else {
                            if (confirmPin === createPin) {
                                savePin(createPin);
                                currentPin = createPin;
                                setMsg("createMsg", "PIN created!", false);
                                setTimeout(loadDash, 500);
                            } else {
                                setMsg("createMsg", "PINs don't match", true);
                                createPin = "";
                                confirmPin = "";
                                isConfirming = false;
                                $("createTitle").textContent = "Create PIN";
                                $("createSub").textContent = "Choose a 4-digit PIN";
                                setDots("c", 0);
                            }
                        }
                    }, 200);
                }
            }
        }, function() {
            if (confirmPin.length > 0) {
                confirmPin = confirmPin.slice(0, -1);
                setDots("c", confirmPin.length);
                $("createMsg").textContent = "";
            }
        });
    }
    
    function loadDash() {
        var s = getStats();
        $("dGames").textContent = s.games || 0;
        $("dBest").textContent = s.bestLevel || "--";
        $("dAvg").textContent = s.games > 0 ? Math.round(s.totalLevel / s.games) : "--";
        $("dRate").textContent = getRating(s.bestLevel);
        show("dashBox");
        showBanner();
        if (!canPlay().ok) showLimit();
    }
    
    function getLevelParams(lvl) {
        // Level 1-3: 3x3 grid, 3-5 tiles
        // Level 4-6: 4x4 grid, 4-6 tiles
        // Level 7-9: 5x5 grid, 5-7 tiles
        // Level 10+: 5x5 grid, 6+ tiles
        if (lvl <= 3) {
            return { grid: 3, tiles: 2 + lvl };
        } else if (lvl <= 6) {
            return { grid: 4, tiles: 3 + (lvl - 3) };
        } else if (lvl <= 9) {
            return { grid: 5, tiles: 4 + (lvl - 6) };
        } else {
            return { grid: 5, tiles: Math.min(10, 6 + (lvl - 9)) };
        }
    }
    
    function buildGrid() {
        var params = getLevelParams(level);
        gridSize = params.grid;
        tilesToShow = params.tiles;
        
        var grid = $("visualGrid");
        grid.innerHTML = "";
        grid.style.gridTemplateColumns = "repeat(" + gridSize + ", 1fr)";
        
        var totalCells = gridSize * gridSize;
        
        for (var i = 0; i < totalCells; i++) {
            var cell = document.createElement("div");
            cell.className = "visual-cell";
            cell.dataset.idx = i;
            cell.onclick = (function(idx) {
                return function() { selectTile(idx); };
            })(i);
            grid.appendChild(cell);
        }
        
        // Select random tiles to light up
        litTiles = [];
        var available = [];
        for (var j = 0; j < totalCells; j++) available.push(j);
        
        for (var k = 0; k < tilesToShow; k++) {
            var randIdx = Math.floor(Math.random() * available.length);
            litTiles.push(available[randIdx]);
            available.splice(randIdx, 1);
        }
        
        selectedTiles = [];
        canSelect = false;
        
        $("gLevel").textContent = level;
        $("gTiles").textContent = tilesToShow;
    }
    
    function showTiles() {
        $("statusMsg").textContent = "Memorize the tiles...";
        var cells = $("visualGrid").children;
        
        litTiles.forEach(function(idx) {
            cells[idx].classList.add("lit");
        });
        
        // Show time based on number of tiles
        var showTime = 1000 + (tilesToShow * 200);
        
        setTimeout(function() {
            litTiles.forEach(function(idx) {
                cells[idx].classList.remove("lit");
            });
            $("statusMsg").textContent = "Select the tiles!";
            canSelect = true;
        }, showTime);
    }
    
    function selectTile(idx) {
        if (!canSelect) return;
        if (selectedTiles.indexOf(idx) !== -1) return;
        
        var cells = $("visualGrid").children;
        selectedTiles.push(idx);
        
        if (litTiles.indexOf(idx) !== -1) {
            // Correct tile
            cells[idx].classList.add("correct");
            
            if (selectedTiles.length === litTiles.length) {
                // All tiles found!
                canSelect = false;
                score += level * 10;
                rounds++;
                $("gScore").textContent = score;
                $("statusMsg").textContent = "Correct! üéâ";
                
                setTimeout(function() {
                    level++;
                    startRound();
                }, 1000);
            }
        } else {
            // Wrong tile
            cells[idx].classList.add("wrong");
            canSelect = false;
            lives--;
            updateLives();
            
            // Show correct tiles
            litTiles.forEach(function(i) {
                if (selectedTiles.indexOf(i) === -1) {
                    cells[i].classList.add("lit");
                }
            });
            
            if (lives <= 0) {
                $("statusMsg").textContent = "Game Over!";
                setTimeout(endGame, 1500);
            } else {
                $("statusMsg").textContent = "Wrong! " + lives + " lives left";
                setTimeout(function() {
                    startRound();
                }, 1500);
            }
        }
    }
    
    function updateLives() {
        var container = $("livesContainer");
        container.innerHTML = "";
        for (var i = 0; i < 3; i++) {
            var span = document.createElement("span");
            span.className = "life" + (i >= lives ? " lost" : "");
            span.textContent = "‚ù§Ô∏è";
            container.appendChild(span);
        }
    }
    
    function startRound() {
        buildGrid();
        updateLives();
        setTimeout(showTiles, 500);
    }
    
    function startGame() {
        if (!canPlay().ok) {
            showLimit();
            return;
        }
        
        level = 1;
        score = 0;
        lives = 3;
        rounds = 0;
        
        $("gScore").textContent = "0";
        show("gameBox");
        startRound();
    }
    
    function endGame() {
        var s = getStats();
        s.games++;
        s.totalLevel += level;
        var isRecord = level > (s.bestLevel || 0);
        if (isRecord) s.bestLevel = level;
        setStats(s);
        
        useTry();
        
        $("resLevel").textContent = level;
        $("resScore").textContent = score;
        $("resRounds").textContent = rounds;
        $("resRating").textContent = "Rating: " + getRating(level);
        
        if (isRecord) {
            $("resRecord").classList.remove("hidden");
        } else {
            $("resRecord").classList.add("hidden");
        }
        
        $("resBg").classList.remove("hidden");
        
        if (!canPlay().ok) {
            setTimeout(showLimit, 1500);
        }
    }
    
    // Initialize
    document.addEventListener("DOMContentLoaded", function() {
        getDeviceId();
        setupLogin();
        setupCreate();
        
        $("toCreate").onclick = function() {
            createPin = "";
            confirmPin = "";
            isConfirming = false;
            $("createTitle").textContent = "Create PIN";
            $("createSub").textContent = "Choose a 4-digit PIN";
            setDots("c", 0);
            $("createMsg").textContent = "";
            show("createBox");
        };
        
        $("toLogin").onclick = function() {
            loginPin = "";
            setDots("d", 0);
            $("loginMsg").textContent = "";
            show("loginBox");
        };
        
        $("startBtn").onclick = function() {
            if (!canPlay().ok) {
                showLimit();
                return;
            }
            startGame();
        };
        
        $("logoutBtn").onclick = function() {
            loginPin = "";
            currentPin = "";
            setDots("d", 0);
            show("loginBox");
        };
        
        $("quitBtn").onclick = function() {
            canSelect = false;
            loadDash();
        };
        
        $("againBtn").onclick = function() {
            $("resBg").classList.add("hidden");
            if (!canPlay().ok) {
                showLimit();
                return;
            }
            startGame();
        };
        
        $("menuBtn").onclick = function() {
            $("resBg").classList.add("hidden");
            loadDash();
        };
        
        $("upgradeBtn").onclick = function() {
            window.location.href = "mailto:support@akashic.works?subject=Pro%20Upgrade";
        };
        
        show("loginBox");
        showBanner();
    });
})();
</script>
</body>
</html>
